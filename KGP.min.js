function initKGP(){"disable"===localStorage["zh.kgp.enable"]||window.KGPInterval?KGPInterval&&(clearInterval(KGPInterval),window.KGPInterval=void 0,initKGPLeftColumn(!1)):game.resPool?window.KGPInterval=setInterval(()=>initKGPLeftColumn(),200):setTimeout(()=>initKGP(),500)}function initKGPLeftColumn(r=!0){const e=$("#leftColumnViewport > div > div:nth-child(1) > div:nth-child(2) > div").find(".res-row"),i=KGP.resMap;e.each(function(e,t){if(!r)return t.removeAttribute("style");var a,n=t.className.split(" ")[1].substring(9);"kittens"!==n&&(t=$(t),(n=i[n])&&(a=n.maxValue,n=n.value,KGP.changeCSS(n,a,t)))}),KGP.updateTooltip()}setTimeout(()=>{initKGP()},201+Math.max(-Date.now()+game.timer.timestampStart,-200)),window.KGP={resMap:game.resPool.resourceMap,resRow:void 0,tool:void 0,updateTooltip:function(){let c=this.resMap;if(game.tooltipUpdateFunc){let t=game.tooltipUpdateFunc,e=$("#tooltip").find(".price-block");t.length||(game.tooltipUpdateFunc=e=>{t(),KGP.updateTooltip()}),e.each((e,n)=>{let t=n.textContent,l=t.replace("/","");if(l!==t){let t=$(n);n=(l=(l=l.replace("*"," ")).replace("+"," ")).trim().split(" ");let a=n[0];var s=a.length;let r,i;for(let e=0;e<s;e++)if(parseFloat(a[e])+1){i=a.substring(0,e),r=a.substring(e,s);break}let o=KGP.getAmountFromFormatted(n[2]);if(r=KGP.getAmountFromFormatted(r),n.length<4){let e,a,n;switch(i){case"眼泪":(e=t.find(".noRes")).text((e,t)=>{var a=2500*Math.ceil((o-r)/game.bld.getBuildingExt("ziggurat").meta.on),n=c.unicorns.perTickCached;if(0<a-c.unicorns.value&&n)return a=(a-c.unicorns.value)/(game.getTicksPerSecondUI()*n),t+" ("+game.toDisplaySeconds(a)+")"});break;case"反物质":a=game.getEffect("antimatterProduction"),o<=c.antimatter.maxValue&&a&&(e=t.find(".noRes")).text((e,t)=>{return t+" ("+Math.ceil((o-r)/a)+"游戏年)"});break;case"遗物":(n=game.getEffect("relicPerDay"))&&(e=t.find(".noRes")).text((e,t)=>{var a=game.time.isAccelerated?1.33:2,a=Math.ceil((o-r)/n)*a;return t+" ("+game.toDisplaySeconds(a)+")"})}}KGP.changeCSS(r,o,t)}})}},changeCSS:function(e,t,a){0<t&&0<e&&(e=100*e/t,a.css("background-repeat","no-repeat"),a.css("background-position","bottom left"),a.css("background-size",Math.min(200,e)+"% 1px"),95<e?a.css("background-image","linear-gradient(0, red, red)"):75<e?a.css("background-image","linear-gradient(0, orange, orange)"):a.css("background-image","linear-gradient(0, green, green)"))},getAmountFromFormatted:function(e){if(!e)return 0;var t=e.slice(-1),a=!isNaN(Number(t)),n=a?Number(e):Number(e.substring(0,e.length-1));if(a)return n;switch(t){case"K":return 1e3*n;case"M":return 1e6*n;case"G":return 1e9*n;case"T":return 1e12*n;case"P":return 1e15*n;default:return 0}}};